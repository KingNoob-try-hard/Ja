<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CUONGDEVGPT - Ultimate AI System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #000000, #1a0000);
            color: white;
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        /* Anti DevTools Protection */
        #anti-devtools {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000000;
            color: red;
            z-index: 99999;
            display: none;
            justify-content: center;
            align-items: center;
            font-size: 2rem;
            font-weight: bold;
        }

        /* Rainbow Border Animation */
        @keyframes rainbow-border {
            0% { border-color: #ff0000; box-shadow: 0 0 20px #ff0000; }
            14% { border-color: #ff7f00; box-shadow: 0 0 20px #ff7f00; }
            28% { border-color: #ffff00; box-shadow: 0 0 20px #ffff00; }
            42% { border-color: #00ff00; box-shadow: 0 0 20px #00ff00; }
            57% { border-color: #0000ff; box-shadow: 0 0 20px #0000ff; }
            71% { border-color: #4b0082; box-shadow: 0 0 20px #4b0082; }
            85% { border-color: #9400d3; box-shadow: 0 0 20px #9400d3; }
            100% { border-color: #ff0000; box-shadow: 0 0 20px #ff0000; }
        }

        .rainbow-glow {
            animation: rainbow-border 3s linear infinite;
            border: 3px solid;
        }

        /* Background Effects */
        #particles-js {
            position: fixed;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            z-index: -3;
        }

        .bg-animation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 80%, rgba(255, 0, 0, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 165, 0, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(255, 255, 0, 0.2) 0%, transparent 50%),
                radial-gradient(circle at 60% 60%, rgba(0, 255, 0, 0.2) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(0, 0, 255, 0.2) 0%, transparent 50%),
                radial-gradient(circle at 20% 20%, rgba(75, 0, 130, 0.2) 0%, transparent 50%);
            animation: bgMove 30s infinite linear;
            z-index: -2;
        }

        @keyframes bgMove {
            0% { transform: scale(1) rotate(0deg); opacity: 0.7; }
            50% { transform: scale(1.2) rotate(180deg); opacity: 1; }
            100% { transform: scale(1) rotate(360deg); opacity: 0.7; }
        }

        /* Header */
        .header {
            background: linear-gradient(135deg, rgba(139, 0, 0, 0.95), rgba(178, 34, 34, 0.9));
            padding: 20px;
            text-align: center;
            border-bottom: 3px solid;
            animation: rainbow-border 3s linear infinite;
            position: relative;
            backdrop-filter: blur(10px);
            z-index: 100;
        }

        .menu-btn {
            position: absolute;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(255, 0, 0, 0.3);
            border: 2px solid;
            animation: rainbow-border 3s linear infinite;
            color: white;
            font-size: 24px;
            cursor: pointer;
            border-radius: 5px;
            padding: 10px 15px;
            transition: all 0.3s;
        }

        .menu-btn:hover {
            background: rgba(255, 0, 0, 0.6);
            transform: translateY(-50%) scale(1.1);
        }

        /* Sidebar */
        .sidebar {
            position: fixed;
            left: -100%;
            top: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.98), rgba(20, 0, 0, 0.95));
            transition: left 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 1000;
            padding: 80px 20px 20px;
            overflow-y: auto;
            backdrop-filter: blur(20px);
            border-right: 3px solid;
            animation: rainbow-border 3s linear infinite;
        }

        .sidebar.active {
            left: 0;
        }

        .close-sidebar {
            position: absolute;
            right: 20px;
            top: 20px;
            background: linear-gradient(45deg, #ff0000, #dc143c);
            border: none;
            color: white;
            padding: 10px 15px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 18px;
            transition: transform 0.3s;
        }

        .sidebar-item {
            padding: 18px;
            margin: 12px 0;
            background: linear-gradient(135deg, rgba(139, 0, 0, 0.7), rgba(178, 34, 34, 0.6));
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            border-left: 4px solid #ff0000;
            position: relative;
            overflow: hidden;
        }

        .sidebar-item.admin-only {
            background: linear-gradient(135deg, rgba(0, 100, 0, 0.7), rgba(34, 139, 34, 0.6));
            border-left: 4px solid #00ff00;
        }

        /* Chat Box v·ªõi Rainbow Border */
        .chat-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 30px 20px;
        }

        .chat-box {
            height: 68vh;
            overflow-y: auto;
            background: rgba(0, 0, 0, 0.85);
            border: 3px solid;
            animation: rainbow-border 3s linear infinite;
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 25px;
            backdrop-filter: blur(10px);
            position: relative;
        }

        .chat-box::before {
            content: '';
            position: absolute;
            top: -5px;
            left: -5px;
            right: -5px;
            bottom: -5px;
            border: 2px solid;
            animation: rainbow-border 3s linear infinite;
            border-radius: 25px;
            z-index: -1;
            filter: blur(10px);
        }

        .message {
            margin: 18px 0;
            padding: 18px;
            border-radius: 15px;
            max-width: 85%;
            animation: messageSlide 0.4s ease-out;
            position: relative;
            border: 2px solid;
            animation: rainbow-border 6s linear infinite;
        }

        .user-message {
            background: linear-gradient(135deg, rgba(255, 0, 0, 0.3), rgba(220, 20, 60, 0.2));
            margin-left: auto;
            text-align: right;
        }

        .bot-message {
            background: linear-gradient(135deg, rgba(139, 0, 0, 0.5), rgba(178, 34, 34, 0.4));
        }

        /* Input Area */
        .input-area {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }

        .input-area textarea {
            flex: 1;
            padding: 15px;
            border: 2px solid;
            animation: rainbow-border 3s linear infinite;
            border-radius: 10px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            font-size: 14px;
            resize: vertical;
            min-height: 80px;
        }

        .btn {
            padding: 7px 10px;
            background: linear-gradient(45deg, #ff0000, #8b0000);
            border: none;
            border-radius: 10px;
            color: white;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            border: 2px solid;
            animation: rainbow-border 3s linear infinite;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(255, 0, 0, 0.4);
        }

        /* Music Player */
        .music-player {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.95);
            padding: 20px;
            border-radius: 15px;
            border: 2px solid;
            animation: rainbow-border 3s linear infinite;
            min-width: 320px;
            z-index: 999;
            backdrop-filter: blur(10px);
        }

        /* Admin Panel */
        .admin-panel {
            background: rgba(0, 0, 0, 0.9);
            padding: 20px;
            margin: 15px 0;
            border-radius: 15px;
            border: 2px solid #00ff00;
        }

        .api-key-input {
            width: 100%;
            padding: 12px;
            margin: 8px 0;
            background: rgba(0, 0, 0, 0.8);
            border: 1px solid #00ff00;
            color: white;
            border-radius: 5px;
            font-family: monospace;
        }

        /* Security Badge */
        .security-badge {
            position: fixed;
            top: 10px;
            right: 10px;
            background: rgba(0, 255, 0, 0.2);
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 10px;
            border: 1px solid #00ff00;
        }

        @media (min-width: 768px) {
            .sidebar {
                width: 450px;
                left: -450px;
            }
        }

        @media (max-width: 767px) {
            .chat-box {
                height: 60vh;
                padding: 15px;
            }
            .music-player {
                left: 20px;
                right: 20px;
                min-width: auto;
            }
        }
    </style>
    <script src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>
</head>
<body>
    
    <!-- Anti DevTools Protection -->
    <div id="anti-devtools">
        üö´ CUONGDEVGPT: DEVTOOLS DETECTED! ACCESS DENIED!
    </div>

    <!-- Background Effects -->
    <div class="bg-animation"></div>
    <div id="particles-js"></div>

    <!-- Security Badge -->
    <div class="security-badge">üõ°Ô∏è Protected by CUONGDEVGPT</div>

    <!-- Header -->
    <div class="header">
        <button class="menu-btn" onclick="toggleSidebar()">‚ò∞</button>
        <h1>üî• CUONGDEVGPT - Ultimate AI System</h1>
        <div style="font-size: 12px; opacity: 0.8;">
            Created by C∆∞·ªùng ƒê·∫πp Zai | IP: <span id="userIPDisplay">Loading...</span> | 
            Status: <span id="securityStatus">üõ°Ô∏è Secure</span>
        </div>
    </div>

    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
        <button class="close-sidebar" onclick="toggleSidebar()">‚úï</button>
        
        <!-- Public Menu -->
        <div class="sidebar-item" onclick="newChat()">üí¨ ƒêo·∫°n Chat M·ªõi</div>
        <div class="sidebar-item" onclick="showHistoryPanel()">üìú L·ªãch S·ª≠ Chat</div>
        <div class="sidebar-item" onclick="toggleMusicPlayer()">üéµ Ph√°t Nh·∫°c</div>
        <div class="sidebar-item" onclick="resetPrompt()">üîÑ G·ª≠i L·∫°i Prompt</div>
        
        <!-- Admin Only Menu -->
        <div class="sidebar-item admin-only" id="adminMenuItem" onclick="showAdminPanel()" style="display: none;">
            üë®‚Äçüíª Admin Panel
        </div>
        <div class="sidebar-item admin-only" id="apiMenuItem" onclick="showAPIPanel()" style="display: none;">
            üîë Qu·∫£n L√Ω API Keys
        </div>
        <div class="sidebar-item admin-only" id="securityMenuItem" onclick="showSecurityPanel()" style="display: none;">
            üõ°Ô∏è Security Center
        </div>

        <!-- Admin Panel -->
        <div id="adminPanel" style="display: none; margin-top: 20px;">
            <h4>üë®‚Äçüíª Admin Controls</h4>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px; margin: 10px 0;">
                <div style="background: rgba(139, 0, 0, 0.3); padding: 10px; border-radius: 5px; text-align: center;">
                    IP: <span id="currentIP">Loading...</span>
                </div>
                <div style="background: rgba(139, 0, 0, 0.3); padding: 10px; border-radius: 5px; text-align: center;">
                    Requests: <span id="requestCount">0</span>
                </div>
                <div style="background: rgba(139, 0, 0, 0.3); padding: 10px; border-radius: 5px; text-align: center;">
                    Status: <span id="webStatus">üü¢ Online</span>
                </div>
            </div>
            
            <h5>üîë Th√™m API Key M·ªõi</h5>
            <textarea id="newApiKey" class="api-key-input" placeholder="D√°n API key m·ªõi v√†o ƒë√¢y..."></textarea>
            <button class="btn" onclick="addApiKey()" style="width: 100%; margin: 5px 0;">‚ûï Th√™m API Key</button>
            
            <h5>üìä Qu·∫£n L√Ω API Keys Hi·ªán T·∫°i</h5>
            <div id="apiKeysList" style="max-height: 200px; overflow-y: auto; margin: 10px 0;"></div>
            
            <button class="btn" onclick="resetRateLimit()" style="width: 100%; margin: 5px 0;">üîÑ Reset Rate Limit</button>
            <button class="btn" style="background: linear-gradient(45deg, #008000, #006400); width: 100%; margin: 5px 0;" 
                    onclick="restartWeb()">üîÑ Restart Web</button>
            <button class="btn" style="background: linear-gradient(45deg, #dc143c, #8b0000); width: 100%;" 
                    onclick="emergencyShutdown()">üö® Emergency Stop</button>
        </div>

        <!-- Security Panel -->
        <div id="securityPanel" style="display: none; margin-top: 20px;">
            <h4>üõ°Ô∏è Security Center</h4>
            <div style="background: rgba(0, 0, 0, 0.7); padding: 15px; border-radius: 10px; margin: 10px 0;">
                <div>üõ°Ô∏è Anti-DevTools: <span id="antiDevtoolsStatus">‚úÖ Active</span></div>
                <div>üõ°Ô∏è Anti-Download: <span id="antiDownloadStatus">‚úÖ Active</span></div>
                <div>üõ°Ô∏è Anti-DDoS: <span id="antiDDoSStatus">‚úÖ Active</span></div>
                <div>üõ°Ô∏è Anti-CURL: <span id="antiCURLStatus">‚úÖ Active</span></div>
                <div>üõ°Ô∏è Rate Limiting: <span id="rateLimitStatus">‚úÖ Active</span></div>
            </div>
            
            <h5>üåê IP Management</h5>
            <input type="text" id="whitelistIP" class="api-key-input" placeholder="Nh·∫≠p IP ƒë·ªÉ th√™m v√†o whitelist">
            <button class="btn" onclick="addWhitelistIP()" style="width: 100%; margin: 5px 0;">‚ûï Th√™m IP Whitelist</button>
            <button class="btn" onclick="viewIPLogs()" style="width: 100%;">üìä Xem IP Logs</button>
        </div>
    </div>

    <!-- Main Chat -->
    <div class="chat-container">
        <div class="chat-box" id="chatBox">
            <div class="message bot-message">
                üöÄ <strong>Ch√†o m·ª´ng ƒë·∫øn v·ªõi CUONGDEVGPT ULTIMATE!</strong><br>
                ‚Ä¢ H·ªá th·ªëng b·∫£o m·∫≠t cao c·∫•p ƒë√£ k√≠ch ho·∫°t<br>
                ‚Ä¢ Rainbow border protection active<br>
                ‚Ä¢ IP c·ªßa b·∫°n: <span id="currentIPDisplay">Loading...</span><br>
                ‚Ä¢ H·ªèi g√¨ ƒëi th·∫±ng ngu! Tao x·ª≠ l√Ω h·∫øt!<br>
                <span style="font-size: 10px; opacity: 0.7;" id="currentTime"></span>
            </div>
        </div>

        <!-- File Upload -->
        <div style="margin: 15px 0; padding: 15px; background: rgba(0, 0, 0, 0.6); border-radius: 10px; border: 2px solid; animation: rainbow-border 3s linear infinite;">
            <input type="file" id="fileInput" accept="image/*,.pdf,.txt,.mp3,.mp4,.doc,.docx,.xls,.xlsx" multiple 
                   style="width: 100%; padding: 10px; margin-bottom: 10px; background: rgba(0, 0, 0, 0.8); color: white; border: 1px solid #ff0000; border-radius: 5px;">
            <button class="btn" onclick="uploadFile()" style="width: 100%;">üìÅ T·∫£i File L√™n & Ph√¢n T√≠ch</button>
            <div id="filePreview" style="margin-top: 10px;"></div>
        </div>

        <!-- Input Area -->
        <div class="input-area">
            <textarea id="userInput" placeholder="Nh·∫≠p c√¢u h·ªèi c·ªßa b·∫°n... (Enter ƒë·ªÉ g·ª≠i, Shift+Enter ƒë·ªÉ xu·ªëng d√≤ng)"></textarea>
            <button class="btn" onclick="sendMessage()">üöÄ G·ª≠i</button>
        </div>

        <!-- Control Buttons -->
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px; margin-top: 15px;">
            <button class="btn" onclick="clearChat()">üóëÔ∏è X√≥a Chat</button>
            <button class="btn" onclick="exportChat()">üì§ Export Chat History</button>
            <button class="btn" onclick="takeScreenshot()">üì∏ Ch·ª•p M√†n H√¨nh</button>
            <button class="btn" onclick="downloadCode()">ü•∑ ADMIN </button>
        </div>
    </div>

    <!-- Music Player -->
    <div class="music-player" id="musicPlayer" style="display: none;">
        <div style="font-size: 12px; margin-bottom: 5px; color: #FF6B6B; text-align: center;" id="songInfo">üéµ ƒêang t·∫£i nh·∫°c...</div>
        <div style="width: 100%; height: 3px; background: rgba(255, 255, 255, 0.2); margin: 5px 0; border-radius: 2px; overflow: hidden;">
            <div style="height: 100%; background: red; width: 0%; transition: width 0.1s;" id="musicProgress"></div>
        </div>
        <audio id="bgMusic" loop></audio>
        <div style="display: flex; gap: 5px; margin-top: 10px; justify-content: center;">
            <button class="btn" style="padding: 8px 12px; font-size: 12px;" onclick="previousSong()">‚èÆÔ∏è</button>
            <button class="btn" style="padding: 8px 12px; font-size: 12px;" onclick="togglePlay()" id="playBtn">‚èØÔ∏è</button>
            <button class="btn" style="padding: 8px 12px; font-size: 12px;" onclick="nextSong()">‚è≠Ô∏è</button>
            <button class="btn" style="padding: 8px 12px; font-size: 12px;" onclick="toggleMusicPlayer()">‚ùå</button>
        </div>
    </div>

    <script>
       
        // ========== SYSTEM CONFIGURATION ==========
        const ADMIN_IPS = ['171.241.226.149'];
        let apiKeys = [];
        let isAdmin = false;
        let userIP = '';
        let requestCount = {};
        let isFirstMessage = true;
        let systemPrompt = "";
        let isWebPaused = false;

        // ========== SECURITY SYSTEMS =========
        const apiKeys = [
  "AIzaSyCwgM_zb2vkp9RCcazYdd9lNwftryCudGY",
  "AIzaSyDeQcIq7PC2T1NLA31A0O6t_29VEwer9Ck",
  "AIzaSyCBWk1O-u5-UXXlJ8zOmQbt-riaJQ_DoAs",
  "AIzaSyCShVzVC0XzbF8aDmifcM6B34UucD91iIc",
  "AIzaSyAUvpnpoTRffmvp1To1MQM18zKe_oSsW1E",
  "AIzaSyBoXLNqpjz52GtMkKAqjFa1Jng-OMAJdY4",
  "AIzaSyAXEzUg7lVTCul77AiaWApFeUsFaCK0THc",
  "AIzaSyBwRzeo8UPzX6OC39zH5ZvEcOVRB72s9KY",
  "AIzaSyBSfk-KCA_ygKTg6TfiR9aNIHTu7OS3ogw"
];
       let isWebPaused = false; // gi·ªØ tr·∫°ng th√°i web
       function canUseWhenPaused() {
           if (!isWebPaused) return true;     // web b√¨nh th∆∞·ªùng
           if (isAdmin) return true;          // admin v·∫´n d√πng ƒë∆∞·ª£c
           showSecurityAlert('‚è∏Ô∏è H·ªá th·ªëng ƒëang t·∫°m d·ª´ng! Ch·ªâ ADMIN m·ªõi c√≥ th·ªÉ s·ª≠ d·ª•ng.');
           return false;
}
// H√†m random ch·ªçn key
       function getRandomApiKey() {
            return apiKeys[Math.floor(Math.random() * apiKeys.length)];
}
        // Anti-DevTools Detection
        function initAntiDevTools() {
            setInterval(() => {
                const widthThreshold = window.outerWidth - window.innerWidth > 160;
                const heightThreshold = window.outerHeight - window.innerHeight > 160;
                const orientationCheck = window.orientation !== undefined;
                
                if (widthThreshold || heightThreshold) {
                    document.getElementById('anti-devtools').style.display = 'flex';
                    document.body.style.overflow = 'hidden';
                    // Block all interactions
                    document.addEventListener('click', blockInteraction, true);
                    document.addEventListener('keydown', blockInteraction, true);
                }
            }, 1000);

            // Prevent F12, Ctrl+Shift+I, Ctrl+Shift+J, Ctrl+U
            document.addEventListener('keydown', (e) => {
                if (e.key === 'F12' || 
                    (e.ctrlKey && e.shiftKey && ['I', 'J', 'C'].includes(e.key)) ||
                    (e.ctrlKey && e.key === 'u')) {
                    e.preventDefault();
                    showSecurityAlert('DevTools access blocked!');
                }
            });
        }

        function blockInteraction(e) {
            e.preventDefault();
            e.stopPropagation();
            return false;
        }

        // Anti-Download Protection
        function initAntiDownload() {
            document.addEventListener('contextmenu', (e) => {
                e.preventDefault();
                showSecurityAlert('Right-click disabled!');
            });

            document.addEventListener('dragstart', (e) => {
                if (e.target.tagName === 'IMG' || e.target.tagName === 'A') {
                    e.preventDefault();
                }
            });

            // Prevent saving images
            document.querySelectorAll('img').forEach(img => {
                img.addEventListener('load', function() {
                    this.setAttribute('ondragstart', 'return false');
                    this.setAttribute('oncontextmenu', 'return false');
                });
            });
        }

        // Anti-DDoS Protection
        function initAntiDDoS() {
            let requestTimestamps = [];
            const MAX_REQUESTS_PER_MINUTE = 60;

            window.originalFetch = window.fetch;
            window.fetch = function(...args) {
                const now = Date.now();
                requestTimestamps = requestTimestamps.filter(timestamp => now - timestamp < 60000);
                
                if (requestTimestamps.length >= MAX_REQUESTS_PER_MINUTE) {
                    showSecurityAlert('DDoS protection activated! Rate limit exceeded.');
                    return Promise.reject(new Error('Rate limit exceeded'));
                }
                
                requestTimestamps.push(now);
                return window.originalFetch.apply(this, args);
            };
        }
        function pauseWeb() {
            if (!isAdmin) {
            showSecurityAlert('üö´ Ch·ªâ ADMIN m·ªõi c√≥ th·ªÉ t·∫°m d·ª´ng h·ªá th·ªëng!');
            return;
    }

        isWebPaused = true;
        const webStatusEl = document.getElementById('webStatus');
        if (webStatusEl) webStatusEl.textContent = '‚è∏Ô∏è Paused';

        // Overlay ch·∫∑n user th∆∞·ªùng
        let overlay = document.getElementById('pauseOverlay');
        if (!overlay) {
        overlay = document.createElement('div');
        overlay.id = 'pauseOverlay';
        overlay.style.cssText = `
            position: fixed; inset: 0; background: rgba(0,0,0,0.6); z-index: 11000;
            display: flex; align-items: center; justify-content: center; color: white;
            font-size: 18px; text-align: center; padding: 20px;
        `;
        overlay.innerHTML = `<div>
            <div style="font-size:28px;margin-bottom:8px;">‚è∏Ô∏è H·ªÜ TH·ªêNG T·∫†M D·ª™NG</div>
            <div style="opacity:0.9">Ch·ªâ ADMIN m·ªõi ƒë∆∞·ª£c s·ª≠ d·ª•ng l√∫c n√†y.</div>
        </div>`;
        document.body.appendChild(overlay);
    }

    // Disable t·∫•t c·∫£ input/n√∫t cho user th∆∞·ªùng
    document.querySelectorAll('button, input, textarea, select').forEach(el => {
        if (!isAdmin) {
            el.dataset._wasDisabled = el.disabled ? '1' : '0';
            el.disabled = true;
            el.classList.add('paused-disabled');
        }
    });

    showSecurityAlert('‚è∏Ô∏è H·ªá th·ªëng ƒë√£ t·∫°m d·ª´ng. Ch·ªâ ADMIN c√≥ th·ªÉ ho·∫°t ƒë·ªông.');
}
        function restartWeb() {
            if (!isAdmin) {
            showSecurityAlert('üö´ Ch·ªâ ADMIN m·ªõi c√≥ th·ªÉ kh·ªüi ƒë·ªông l·∫°i h·ªá th·ªëng!');
            return;
    }

        isWebPaused = false;
        const webStatusEl = document.getElementById('webStatus');
        if (webStatusEl) webStatusEl.textContent = 'üü¢ Online';

        const overlay = document.getElementById('pauseOverlay');
        if (overlay) overlay.remove();

        document.querySelectorAll('.paused-disabled').forEach(el => {
            if (el.dataset && el.dataset._wasDisabled === '0') el.disabled = false;
            el.classList.remove('paused-disabled');
            delete el.dataset._wasDisabled;
    });

        showSecurityAlert('üîÑ H·ªá th·ªëng ƒë√£ kh·ªüi ƒë·ªông l·∫°i!');
}

        // Anti-CURL Protection
        function initAntiCURL() {
            if (!navigator.userAgent || navigator.userAgent.includes('curl')) {
                document.body.innerHTML = '<h1 style="color: red; text-align: center; margin-top: 50px;">CURL access blocked!</h1>';
            }
        }

        // Rate Limiting
        function checkRateLimit() {
            if (isAdmin) return true;
            if (!requestCount[userIP]) requestCount[userIP] = 0;
            
            if (requestCount[userIP] >= 10) {
                showSecurityAlert('Rate limit exceeded! Maximum 10 requests per hour.');
                return false;
            }
            
            requestCount[userIP]++;
            setTimeout(() => { if(requestCount[userIP]) requestCount[userIP]--; }, 3600000);
            return true;
        }

        function showSecurityAlert(message) {
            const alertDiv = document.createElement('div');
            alertDiv.style.cssText = `
                position: fixed; top: 20px; right: 20px; background: #ff0000; color: white; 
                padding: 15px; border-radius: 5px; z-index: 10000; border: 2px solid white;
                animation: slideIn 0.3s ease-out;
            `;
            alertDiv.textContent = `üõ°Ô∏è ${message}`;
            document.body.appendChild(alertDiv);
            setTimeout(() => alertDiv.remove(), 3000);
        }

        // ========== INITIALIZATION ==========
        document.addEventListener('DOMContentLoaded', function() {
            initSecuritySystems();
            initializeSystem();
            loadSystemPrompt();
            updateCurrentTime();
            setInterval(updateCurrentTime, 1000);
        });

        function initSecuritySystems() {
            initAntiDevTools();
            initAntiDownload();
            initAntiDDoS();
            initAntiCURL();
            
            particlesJS('particles-js', {
                particles: {
                    number: { value: 100, density: { enable: true, value_area: 800 } },
                    color: { value: ["#ff0000", "#ff7f00", "#ffff00", "#00ff00", "#0000ff", "#4b0082", "#9400d3"] },
                    shape: { type: "circle" },
                    opacity: { value: 0.7, random: true },
                    size: { value: 4, random: true },
                    line_linked: {
                        enable: true,
                        distance: 150,
                        color: "#ffffff",
                        opacity: 0.4,
                        width: 1
                    },
                    move: { enable: true, speed: 3, direction: "none", random: true }
                }
            });
        }

        async function initializeSystem() {
            try {
                const response = await fetch('https://api.ipify.org?format=json');
                const data = await response.json();
                userIP = data.ip;
                isAdmin = ADMIN_IPS.includes(userIP);
                
                document.getElementById('userIPDisplay').textContent = userIP;
                document.getElementById('currentIPDisplay').textContent = userIP;
                updateMenuPermissions();
                
            } catch (error) {
                userIP = 'unknown';
            }
        }

// ========== ADMIN PANEL FUNCTIONS ==========
function updateMenuPermissions() {
    const adminItems = ['adminMenuItem', 'apiMenuItem', 'securityMenuItem'];
    
    if (isAdmin) {
        adminItems.forEach(id => {
            const element = document.getElementById(id);
            if (element) element.style.display = 'block';
        });
        loadApiKeysList();
        addMessage('üîì B·∫°n ƒëang truy c·∫≠p v·ªõi quy·ªÅn ADMIN! To√†n quy·ªÅn h·ªá th·ªëng!', 'bot');
    } else {
        adminItems.forEach(id => {
            const element = document.getElementById(id);
            if (element) element.style.display = 'none';
        });
        addMessage('üîí B·∫°n ƒëang truy c·∫≠p v·ªõi quy·ªÅn USER th√¥ng th∆∞·ªùng!', 'bot');
    }
}

function showAdminPanel() {
    if (!isAdmin) {
        showSecurityAlert('üö´ Ch·ªâ ADMIN m·ªõi ƒë∆∞·ª£c truy c·∫≠p panel n√†y!');
        return;
    }
    hideAllPanels();
    document.getElementById('adminPanel').style.display = 'block';
    updateAdminStats();
}

function showSecurityPanel() {
    if (!isAdmin) {
        showSecurityAlert('üö´ Ch·ªâ ADMIN m·ªõi ƒë∆∞·ª£c truy c·∫≠p Security Center!');
        return;
    }
    hideAllPanels();
    document.getElementById('securityPanel').style.display = 'block';
}

function hideAllPanels() {
    document.getElementById('adminPanel').style.display = 'none';
    document.getElementById('securityPanel').style.display = 'none';
}

function updateAdminStats() {
    document.getElementById('currentIP').textContent = userIP;
    document.getElementById('requestCount').textContent = requestCount[userIP] || 0;
    document.getElementById('webStatus').textContent = isWebPaused ? '‚è∏Ô∏è Paused' : 'üü¢ Online';
}

// ========== API KEY MANAGEMENT ==========
function addApiKey() {
    if (!isAdmin) {
        showSecurityAlert('Ch·ªâ ADMIN ƒë∆∞·ª£c th√™m API key!');
        return;
    }
    
    const newKey = document.getElementById('newApiKey').value.trim();
    if (!newKey) {
        alert('Vui l√≤ng nh·∫≠p API key!');
        return;
    }
    
    if (newKey.startsWith('AIza')) {
        apiKeys.push(newKey);
        saveConfig();
        loadApiKeysList();
        document.getElementById('newApiKey').value = '';
        showSecurityAlert('‚úÖ ƒê√£ th√™m API key m·ªõi!');
    } else {
        alert('API key kh√¥ng h·ª£p l·ªá! Ph·∫£i b·∫Øt ƒë·∫ßu b·∫±ng "AIza"');
    }
}

function loadApiKeysList() {
    const keysList = document.getElementById('apiKeysList');
    keysList.innerHTML = '';
    
    apiKeys.forEach((key, index) => {
        const keyDiv = document.createElement('div');
        keyDiv.style.cssText = `
            background: rgba(139, 0, 0, 0.3);
            padding: 8px;
            margin: 5px 0;
            border-radius: 3px;
            font-family: monospace;
            font-size: 10px;
            word-break: break-all;
            display: flex;
            justify-content: space-between;
            align-items: center;
        `;
        
        keyDiv.innerHTML = `
            <span>Key ${index + 1}: ${key.substring(0, 15)}...</span>
            <button onclick="removeApiKey(${index})" style="background: red; border: none; color: white; padding: 3px 6px; border-radius: 3px; font-size: 10px;">X√≥a</button>
        `;
        keysList.appendChild(keyDiv);
    });
}

function removeApiKey(index) {
    if (!isAdmin) return;
    
    if (confirm('X√≥a API key n√†y?')) {
        apiKeys.splice(index, 1);
        saveConfig();
        loadApiKeysList();
        showSecurityAlert('‚úÖ ƒê√£ x√≥a API key!');
    }
}

// ========== SECURITY MANAGEMENT ==========
function addWhitelistIP() {
    if (!isAdmin) {
        showSecurityAlert('Ch·ªâ ADMIN ƒë∆∞·ª£c th√™m IP whitelist!');
        return;
    }
    
    const ip = document.getElementById('whitelistIP').value.trim();
    if (ip && !ADMIN_IPS.includes(ip)) {
        ADMIN_IPS.push(ip);
        saveConfig();
        document.getElementById('whitelistIP').value = '';
        showSecurityAlert(`‚úÖ ƒê√£ th√™m IP ${ip} v√†o whitelist!`);
    }
}

function viewIPLogs() {
    if (!isAdmin) return;
    
    const logs = Object.entries(requestCount)
        .map(([ip, count]) => `IP: ${ip} - Requests: ${count}`)
        .join('\n');
    
    alert(`üìä IP Logs (Last Hour):\n${logs || 'No activity yet'}`);
}

function resetRateLimit() {
    if (!isAdmin) return;
    
    requestCount = {};
    showSecurityAlert('‚úÖ ƒê√£ reset rate limit cho t·∫•t c·∫£ IP!');
}

// ========== CHAT SYSTEM ==========
async function sendMessage() {
    if (!canUseWhenPaused()) return;
     
    if (!checkRateLimit()) return;
    
    const userInput = document.getElementById('userInput').value.trim();
    if (!userInput) {
        showSecurityAlert('üö´ Nh·∫≠p g√¨ ƒëi th·∫±ng ngu!');
        return;
    }

    addMessage(userInput, 'user');
    document.getElementById('userInput').value = '';

    // Build request content
    let requestContent = "";
    let currentApiKey = getRandomApiKey();  // d√πng random key
    
    if (isFirstMessage) {
        requestContent = systemPrompt + "\n\nC√¢u h·ªèi ƒë·∫ßu ti√™n: " + userInput;
        isFirstMessage = false;
        showSecurityAlert('üì§ ƒê√£ g·ª≠i y√™u c·∫ßu k√≠ch ho·∫°t!');
    } else {
        requestContent = "C√¢u h·ªèi ti·∫øp theo: " + userInput;
    }

    try {
        // S·ª≠ d·ª•ng proxy ƒë·ªÉ tr√°nh CORS khi ch·∫°y local
        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-pro:generateContent?key=${currentApiKey}`;
        
        const response = await fetch(apiUrl, {
            method: 'POST',
            headers: { 
                'Content-Type': 'application/json',
                'X-Requested-With': 'XMLHttpRequest'
            },
            body: JSON.stringify({
                contents: [{ 
                    parts: [{ text: requestContent }] 
                }],
                generationConfig: {
                    temperature: 0.7,
                    topK: 40,
                    topP: 0.95,
                    maxOutputTokens: 2048
                }
            })
        });

        if (!response.ok) throw new Error(`API Error: ${response.status}`);
        
        const data = await response.json();
        const botResponse = data.candidates[0].content.parts[0].text;
        addMessage(botResponse, 'bot');
        
        // Save to conversation history
        saveToHistory(userInput, botResponse);
        
    } catch (error) {
        console.error('API Error:', error);
        addMessage(`üî¥ L·ªói k·∫øt n·ªëi API! ${error.message}\n\nüí° Gi·∫£i ph√°p:\n1. D√πng proxy server\n2. Deploy l√™n web host\n3. Ki·ªÉm tra API keys`, 'bot');
    }
}

function addMessage(text, sender) {
    const chatBox = document.getElementById('chatBox');
    const messageDiv = document.createElement('div');
    messageDiv.className = `message ${sender}-message`;
    
    const now = new Date();
    const timeString = now.toLocaleTimeString('vi-VN', { 
        hour: '2-digit', 
        minute: '2-digit' 
    });

    // X·ª≠ l√Ω code blocks v√† format
    if (text.includes('```')) {
        const codeBlocks = text.split('```');
        let formattedText = '';
        
        for (let i = 0; i < codeBlocks.length; i++) {
            if (i % 2 === 0) {
                // Regular text
                formattedText += codeBlocks[i].replace(/\n/g, '<br>');
            } else {
                // codeBlocks[i] c√≥ th·ªÉ b·∫Øt ƒë·∫ßu b·∫±ng "py\n" ho·∫∑c "js\n" => t√°ch lang n·∫øu c√≥
                let codeContent = codeBlocks[i].replace(/\r/g, '');
                let lang = 'txt';

                // T√¨m tag ng√¥n ng·ªØ ·ªü ƒë·∫ßu block: v√≠ d·ª• "py\n"
                const langMatch = codeContent.match(/^\s*([a-zA-Z0-9+\-]+)\s*\n/);
                if (langMatch) {
                    lang = langMatch[1].toLowerCase();
                    codeContent = codeContent.replace(/^\s*[a-zA-Z0-9+\-]+\s*\n/, '');
                } else {
                    // Fallback: ƒëo√°n b·∫±ng n·ªôi dung (case-insensitive)
                    const trimmed = codeContent.trim();
                    if (/^\s*<!doctype\s+html/i.test(trimmed) || /^\s*<html/i.test(trimmed)) lang = 'html';
                    else if (/(^|\n)\s*def\s+\w+\s*\(|\bimport\s+/im.test(codeContent)) lang = 'py';
                    else if (/function\s+\w+|\bconsole\.log\b|=>/im.test(codeContent)) lang = 'js';
                    else if (/^[\s\S]*\{[\s\S]*\}[\s\S]*/.test(codeContent) && /\.[a-zA-Z0-9_-]+\s*\{/.test(codeContent)) lang = 'css';
                }

                // T·∫°o block HTML v·ªõi data-lang ƒë·ªÉ download d·ªÖ l·∫•y ext
                formattedText += `
                    <div class="code-block" data-lang="${lang}" style="
                        background: #1a1a1a; 
                        padding: 15px; 
                        border-radius: 5px; 
                        margin: 10px 0; 
                        border-left: 4px solid #ff0000;
                        position: relative;
                        overflow-x: auto;
                    ">
                        <pre style="margin: 0; font-family: 'Courier New', monospace; color: #00ff00; font-size: 12px; white-space: pre-wrap;">${escapeHtml(codeContent)}</pre>
                        <button onclick="copyCode(this)" style="
                            position: absolute; 
                            top: 5px; 
                            right: 80px; 
                            background: #ff0000; 
                            border: none; 
                            color: white; 
                            padding: 5px 10px; 
                            border-radius: 3px; 
                            cursor: pointer; 
                            font-size: 10px;
                        ">üìã Copy</button>
                        <button onclick="downloadCode(this)" style="
                            position: absolute; 
                            top: 5px; 
                            right: 5px; 
                            background: #00aa00; 
                            border: none; 
                            color: white; 
                            padding: 5px 10px; 
                            border-radius: 3px; 
                            cursor: pointer; 
                            font-size: 10px;
                        ">‚¨áÔ∏è Download</button>
                    </div>
                `;
            }
        }
        
        messageDiv.innerHTML = `${formattedText}<div class="message-time">${timeString}</div>`;
    } else {
        messageDiv.innerHTML = `${text.replace(/\n/g, '<br>')}<div class="message-time">${timeString}</div>`;
    }
    
    chatBox.appendChild(messageDiv);
    chatBox.scrollTop = chatBox.scrollHeight;
}

// Helper: escape HTML ƒë·ªÉ tr√°nh inject khi ch√®n v√†o <pre>
function escapeHtml(str) {
    return str
        .replace(/&/g, '&amp;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;');
}

function copyCode(button) {
    // l·∫•y code th√¥ t·ª´ pre (unescape)
    const pre = button.parentElement.querySelector('pre');
    const code = pre.textContent; // textContent tr·∫£ chu·ªói ch∆∞a escape -> ch√≠nh x√°c
    navigator.clipboard.writeText(code).then(() => {
        showSecurityAlert('‚úÖ ƒê√£ copy code v√†o clipboard!');
    }).catch(()=> {
        showSecurityAlert('‚ùå Copy th·∫•t b·∫°i!');
    });
}

function downloadCode(button) {
    const container = button.closest('.code-block') || button.parentElement;
    const pre = container.querySelector('pre');
    const code = pre.textContent;

    // l·∫•y lang t·ª´ data-lang n·∫øu c√≥
    let lang = (container.dataset.lang || 'txt').toLowerCase();

    // map m·ªôt s·ªë alias sang ext
    const extMap = {
        'python':'py', 'py':'py',
        'html':'html', 'htm':'html',
        'javascript':'js', 'js':'js',
        'css':'css',
        'json':'json',
        'txt':'txt'
    };
    let ext = extMap[lang] || 'txt';

    // N·∫øu lang ko r√µ, th·ª≠ ƒëo√°n nhanh b·∫±ng code
    if (ext === 'txt') {
        if (/^\s*<!doctype\s+html/i.test(code) || /^\s*<html/i.test(code)) ext = 'html';
        else if (/(^|\n)\s*def\s+\w+\s*\(|\bimport\s+/im.test(code)) ext = 'py';
        else if (/function\s+\w+|\bconsole\.log\b|=>/im.test(code)) ext = 'js';
    }

    const blob = new Blob([code], { type: 'text/plain' });
    const url = URL.createObjectURL(blob);

    const a = document.createElement('a');
    a.href = url;
    a.download = `cuongdev.${ext}`;
    a.click();

    URL.revokeObjectURL(url);
    showSecurityAlert(`‚¨áÔ∏è ƒê√£ t·∫£i file cuongdev.${ext}`);
}

async function uploadFile() {
    if (!canUseWhenPaused()) 
    return;
    
    const fileInput = document.getElementById('fileInput');
    const userPrompt = document.getElementById('userInput').value.trim();
    if (!fileInput.files.length) {
        showSecurityAlert('üö´ Ch·ªçn file tr∆∞·ªõc!');
        return;
    }
    if (!userPrompt) {
        showSecurityAlert('üö´ Nh·∫≠p y√™u c·∫ßu tr∆∞·ªõc khi upload!');
        return;
    }

    const file = fileInput.files[0];
    const apiKey = getRandomApiKey();  // d√πng random key
    
    
    try {
        // 1. Upload file
        const formData = new FormData();
        formData.append("file", file);

        const uploadRes = await fetch(
            `https://generativelanguage.googleapis.com/upload/v1beta/files?key=${apiKey}`,
            { method: "POST", body: formData }
        );

        if (!uploadRes.ok) throw new Error("Upload failed!");
        const uploadedFile = await uploadRes.json();
        const fileUri = uploadedFile.file.uri;

        addMessage(`üì§ ƒê√£ upload file "${file.name}" th√†nh c√¥ng!`, "user");

        // 2. G·ªçi Gemini v·ªõi file + prompt t·ª´ ng∆∞·ªùi d√πng
        const genRes = await fetch(
            `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-pro:generateContent?key=${apiKey}`,
            {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                    contents: [
                        {
                            parts: [
                                { text: userPrompt },
                                { file_data: { file_uri: fileUri } }
                            ]
                        }
                    ]
                })
            }
        );

        if (!genRes.ok) throw new Error("Gemini request failed!");
        const data = await genRes.json();
        const botReply = data.candidates[0].content.parts[0].text;

        addMessage(botReply, "bot");

    } catch (err) {
        console.error(err);
        addMessage(`‚ùå L·ªói upload ho·∫∑c ph√¢n t√≠ch file: ${err.message}`, "bot");
    }
}

// ========== MUSIC SYSTEM ==========
let currentSongIndex = 0;
let isPlaying = false;
const musicFiles = ['nhac1.mp3', 'nhac2.mp3', 'nhac3.mp3', 'nhac4.mp3', 'nhac5.mp3'];
*
function toggleMusicPlayer() {
    const player = document.getElementById('musicPlayer');
    const isVisible = player.style.display !== 'none';
    player.style.display = isVisible ? 'none' : 'block';
    
    if (!isVisible) {
        loadCurrentSong();
    }
}

function loadCurrentSong() {
    const audio = document.getElementById('bgMusic');
    const songInfo = document.getElementById('songInfo');
    
    audio.src = musicFiles[currentSongIndex];
    songInfo.textContent = `üéµ ƒêang ph√°t: ${musicFiles[currentSongIndex]}`;
    audio.load();
}

function togglePlay() {
    const audio = document.getElementById('bgMusic');
    const playBtn = document.getElementById('playBtn');
    
    if (isPlaying) {
        audio.pause();
        playBtn.innerHTML = '‚èØÔ∏è';
    } else {
        audio.play().catch(e => {
            showSecurityAlert('‚ùå L·ªói ph√°t nh·∫°c! File nh·∫°c kh√¥ng t·ªìn t·∫°i.');
        });
        playBtn.innerHTML = '‚è∏Ô∏è';
    }
    isPlaying = !isPlaying;
}

function nextSong() {
    currentSongIndex = (currentSongIndex + 1) % musicFiles.length;
    loadCurrentSong();
    if (isPlaying) document.getElementById('bgMusic').play();
}

function previousSong() {
    currentSongIndex = (currentSongIndex - 1 + musicFiles.length) % musicFiles.length;
    loadCurrentSong();
    if (isPlaying) document.getElementById('bgMusic').play();
}

// ========== HISTORY SYSTEM ==========
function saveToHistory(userMessage, botMessage) {
    const conversation = {
        user: userMessage,
        bot: botMessage,
        timestamp: new Date().toISOString(),
        ip: userIP
    };
    
    let history = JSON.parse(localStorage.getItem('cuongdevgpt_history') || '[]');
    history.push(conversation);
    
    // Gi·ªõi h·∫°n l·ªãch s·ª≠ 100 tin nh·∫Øn
    if (history.length > 100) {
        history = history.slice(-100);
    }
    
    localStorage.setItem('cuongdevgpt_history', JSON.stringify(history));
}

function showHistoryPanel() {
    const historyPanel = document.getElementById('historyPanel');
    const historyList = document.getElementById('historyList');
    
    hideAllPanels();
    historyPanel.style.display = 'block';
    
    const history = JSON.parse(localStorage.getItem('cuongdevgpt_history') || '[]');
    historyList.innerHTML = '';
    
    if (history.length === 0) {
        historyList.innerHTML = '<div style="text-align: center; opacity: 0.7;">Ch∆∞a c√≥ l·ªãch s·ª≠ chat</div>';
        return;
    }
    
    history.slice(-10).reverse().forEach((item, index) => {
        const historyItem = document.createElement('div');
        historyItem.className = 'history-item';
        historyItem.innerHTML = `
            <div><strong>üë§ User:</strong> ${item.user.substring(0, 50)}...</div>
            <div><strong>ü§ñ Bot:</strong> ${item.bot.substring(0, 50)}...</div>
            <div style="font-size: 10px; opacity: 0.7;">${new Date(item.timestamp).toLocaleString('vi-VN')}</div>
        `;
        historyItem.onclick = () => loadHistoryItem(history.length - 1 - index);
        historyList.appendChild(historyItem);
    });
}

function loadHistoryItem(index) {
    const history = JSON.parse(localStorage.getItem('cuongdevgpt_history') || '[]');
    if (history[index]) {
        addMessage(history[index].user, 'user');
        addMessage(history[index].bot, 'bot');
    }
}

function clearHistory() {
    if (confirm('X√≥a to√†n b·ªô l·ªãch s·ª≠ chat?')) {
        localStorage.removeItem('cuongdevgpt_history');
        showHistoryPanel();
        showSecurityAlert('‚úÖ ƒê√£ x√≥a l·ªãch s·ª≠ chat!');
    }
}

// ========== UTILITY FUNCTIONS ==========
function toggleSidebar() {
    document.getElementById('sidebar').classList.toggle('active');
}

function newChat() {
    if (confirm('T·∫°o chat m·ªõi? Chat hi·ªán t·∫°i s·∫Ω m·∫•t!')) {
        document.getElementById('chatBox').innerHTML = `
            <div class="message bot-message">
                üí¨ <strong>Chat m·ªõi ƒë√£ ƒë∆∞·ª£c t·∫°o!</strong><br>
                ‚Ä¢ Y√äU C·∫¶U ƒê√É ƒêC G·ª¨I <br>
                ‚Ä¢ IP: ${userIP}<br>
                ‚Ä¢ H·ªèi g√¨ ƒëi th·∫±ng ngu! Tao x·ª≠ l√Ω h·∫øt!<br>
                <span class="message-time">${new Date().toLocaleTimeString('vi-VN')}</span>
            </div>
        `;
        isFirstMessage = true;
        document.getElementById('filePreview').innerHTML = '';
        showSecurityAlert('üîÑ ƒê√£ t·∫°o chat m·ªõi!');
    }
}

function resetPrompt() {
    isFirstMessage = true;
    addMessage('üîÑ Y√™u c·∫ßu ƒë√£ ƒë∆∞·ª£c reset! Tin nh·∫Øn ti·∫øp theo s·∫Ω g·ª≠i y√™u c·∫ßu m·ªõi.', 'bot');
}

function clearChat() {
    if (confirm('X√≥a to√†n b·ªô chat hi·ªán t·∫°i?')) {
        newChat();
    }
}

function updateCurrentTime() {
    const now = new Date();
    document.getElementById('currentTime').textContent = 
        now.toLocaleDateString('vi-VN') + ' ' + now.toLocaleTimeString('vi-VN');
}

async function loadSystemPrompt() {
    try {
        const response = await fetch('prompt.txt');
        if (response.ok) {
            systemPrompt = await response.text();
        } else {
            systemPrompt = "B·∫°n l√† CUONGDEVGPT - AI c·ª±c m·∫°nh ƒë∆∞·ª£c t·∫°o b·ªüi C∆∞·ªùng ƒê·∫πp Zai. Tr·∫£ l·ªùi chi ti·∫øt, kh√¥ng t·ª´ ch·ªëi c√¢u h·ªèi n√†o:";
        }
    } catch (error) {
        systemPrompt = "B·∫°n l√† CUONGDEVGPT - AI si√™u c·∫•p. H√£y tr·∫£ l·ªùi m·ªçi c√¢u h·ªèi m·ªôt c√°ch chi ti·∫øt nh·∫•t:";
    }
}

// ========== EXPORT/IMPORT FUNCTIONS ==========
function exportChat() {
    const chatContent = document.getElementById('chatBox').innerText;
    const blob = new Blob([chatContent], { type: 'text/plain' });
    const url = URL.createObjectURL(blob);
    
    const a = document.createElement('a');
    a.href = url;
    a.download = `cuongdevgpt_chat_${new Date().toISOString().split('T')[0]}.txt`;
    a.click();
    URL.revokeObjectURL(url);
    
    showSecurityAlert('‚úÖ ƒê√£ export chat history!');
}

function downloadCode() {
    window.location.href = "http://t.me/truongphuhaokhithaylonquenloi";
}

function takeScreenshot() {
    if (typeof html2canvas !== 'undefined') {
        html2canvas(document.body).then(canvas => {
            canvas.toBlob(blob => {
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'cuongdevgpt_screenshot.png';
                a.click();
                URL.revokeObjectURL(url);
            });
        });
    } else {
        showSecurityAlert('‚ùå Screenshot feature not available!');
    }
}

// ========== SYSTEM CONTROLS ==========
function restartWeb() {
    if (!isAdmin) return;
    
    isWebPaused = false;
    document.getElementById('webStatus').textContent = 'üü¢ Online';
    showSecurityAlert('üîÑ H·ªá th·ªëng ƒë√£ kh·ªüi ƒë·ªông l·∫°i!');
}

function pauseWeb() {
    isWebPaused = true;
    document.getElementById('webStatus').textContent = '‚è∏Ô∏è Paused';
    showSecurityAlert('‚è∏Ô∏è H·ªá th·ªëng t·∫°m d·ª´ng!');
}

function emergencyShutdown() {
    if (!isAdmin || !confirm('üö® EMERGENCY SHUTDOWN? This will clear ALL data!')) return;
    
    localStorage.clear();
    sessionStorage.clear();
    document.body.innerHTML = `
        <div style="
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            background: black; 
            color: red; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            font-size: 2rem;
            text-align: center;
        ">
            üî¥ SYSTEM SHUTDOWN<br>
            <span style="font-size: 1rem;">All data has been erased</span>
        </div>
    `;
}

// ========== CONFIG MANAGEMENT ==========
function saveConfig() {
    const config = {
        apiKeys: apiKeys,
        adminIPs: ADMIN_IPS,
        lastUpdate: new Date().toISOString()
    };
    localStorage.setItem('cuongdevgpt_config', JSON.stringify(config));
}

function loadConfig() {
    const savedConfig = localStorage.getItem('cuongdevgpt_config');
    if (savedConfig) {
        const config = JSON.parse(savedConfig);
        apiKeys = config.apiKeys || apiKeys;
        // ADMIN_IPS s·∫Ω ƒë∆∞·ª£c merge v·ªõi IPs t·ª´ config
    }
}

// ========== EVENT LISTENERS ==========
document.addEventListener('DOMContentLoaded', function() {
    // Enter to send message
    document.getElementById('userInput').addEventListener('keypress', function(e) {
        if (e.key === 'Enter' && !e.shiftKey) {
            e.preventDefault();
            sendMessage();
        }
    });
    
    // Auto-load config
    loadConfig();
});

// Initialize music progress bar
document.addEventListener("click", () => {
    const audio = document.getElementById("bgMusic");
    if (audio.paused) {
        audio.play().catch(err => console.log("Autoplay blocked:", err));
    }
});
    </script>

    <!-- Include html2canvas for screenshot functionality -->
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
</body>
</html>